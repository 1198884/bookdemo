import{d as I,r as W,x as L,q as O,b as j,o as A,c as G,e as l,f as t,g as i,t as Y,w as a,E as y,a as H,p as f,i as m,T as J,U as K,V as Q,j as X,L as Z,M as ee,v as te,_ as ae}from"./index-BwdTnk9D.js";import{u as oe}from"./report-C7K7dR-S.js";const le={class:"report-editor-container"},se={class:"editor-header"},ne={class:"back-button"},re={class:"page-title"},ie={class:"action-buttons"},de={class:"editor-content"},ce={class:"card-header"},ue={class:"header-icon"},me={class:"card-header"},pe={class:"header-icon success-icon"},ge={class:"card-header"},_e={class:"header-icon warning-icon"},fe={class:"card-header"},he={class:"header-icon primary-icon"},ve={class:"card-header"},ke={class:"header-icon info-icon"},we={class:"submit-actions"},be=I({__name:"CreateReport",setup(ye){const h=H(),v=O(),x=oe(),D=W(),k=W(!1),V=L(()=>v.path.includes("/edit/")||v.params.id!==void 0),g=new Date,S=g.getFullYear(),C=(n=>{const e=new Date(n.getFullYear(),0,1),s=(n.getTime()-e.getTime())/864e5;return Math.ceil((s+e.getDay()+1)/7)})(g),T=()=>{const n=new Date(g);n.setDate(g.getDate()-g.getDay()+1);const e=new Date(n);return e.setDate(n.getDate()+6),[P(n),P(e)]},P=n=>{const e=n.getFullYear(),s=String(n.getMonth()+1).padStart(2,"0"),u=String(n.getDate()).padStart(2,"0");return`${e}-${s}-${u}`},o=j({title:"",accomplishments:"",challenges:"",nextWeekPlan:"",weekNumber:C,year:S,completionRate:75}),c=W(T()),E={title:[{required:!0,message:"请输入周报标题",trigger:"blur"},{min:5,max:50,message:"标题长度应为5到50个字符",trigger:"blur"}],accomplishments:[{required:!0,message:"请描述本周完成的工作",trigger:"blur"},{min:10,message:"请至少输入10个字符",trigger:"blur"}],challenges:[{required:!0,message:"请描述本周遇到的问题",trigger:"blur"},{min:10,message:"请至少输入10个字符",trigger:"blur"}],nextWeekPlan:[{required:!0,message:"请描述下周工作计划",trigger:"blur"},{min:10,message:"请至少输入10个字符",trigger:"blur"}]},q=()=>{if(V.value){const n=v.params.id,e=x.getReport(n);if(e){if(o.title=e.title,typeof e.content=="string")o.accomplishments=e.content||"",o.challenges="",o.nextWeekPlan="";else{const s=e.content;o.accomplishments=s.accomplishments||"",o.challenges=s.challenges||"",o.nextWeekPlan=s.nextWeekPlan||"",o.completionRate=s.completionRate||75,s.weekStart&&s.weekEnd&&(c.value=[s.weekStart,s.weekEnd])}o.weekNumber=e.weekNumber,o.year=e.year}else y.error("未找到指定周报"),h.push("/report/list")}},z=()=>{c.value&&console.log("Date range updated",c.value)},B=n=>n+"%",M=async()=>{D.value&&await D.value.validate(n=>{var e,s;if(n){k.value=!0;try{const u={accomplishments:o.accomplishments,challenges:o.challenges,nextWeekPlan:o.nextWeekPlan,completionRate:o.completionRate,weekStart:(e=c.value)==null?void 0:e[0],weekEnd:(s=c.value)==null?void 0:s[1]},d={title:o.title,content:u,weekNumber:o.weekNumber,year:o.year};V.value?(x.updateReport(v.params.id,d),y.success("周报更新成功")):x.addReport(d),h.push("/report/list")}catch(u){y.error("保存失败，请稍后重试"),console.error("Save error:",u)}finally{k.value=!1}}else y.warning("请完善表单信息")})},R=()=>{o.title||o.accomplishments||o.challenges||o.nextWeekPlan?ee.confirm("您有未保存的内容，确定要离开吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{h.back()}).catch(()=>{}):h.back()};return A(()=>{q()}),(n,e)=>{const s=i("el-button"),u=i("el-tag"),d=i("el-icon"),w=i("el-input"),p=i("el-form-item"),_=i("el-card"),b=i("el-col"),N=i("el-row"),U=i("el-date-picker"),F=i("el-slider"),$=i("el-form");return te(),G("div",le,[l("div",se,[l("div",ne,[t(s,{onClick:R,icon:"ArrowLeft",plain:"",round:"",size:"large"})]),l("div",re,[l("h2",null,Y(V.value?"编辑周报":"创建周报"),1),t(u,{effect:"light",size:"large",class:"week-tag"},{default:a(()=>[f(Y(m(S))+"年 第"+Y(m(C))+"周 ",1)]),_:1})]),l("div",ie,[t(s,{onClick:R,plain:""},{default:a(()=>e[6]||(e[6]=[f("取消")])),_:1}),t(s,{type:"primary",loading:k.value,onClick:M},{default:a(()=>e[7]||(e[7]=[f(" 保存周报 ")])),_:1},8,["loading"])])]),l("div",de,[t($,{ref_key:"reportForm",ref:D,model:o,rules:E,"label-position":"top","status-icon":""},{default:a(()=>[t(_,{class:"editor-card",shadow:"hover"},{header:a(()=>[l("div",ce,[l("div",ue,[t(d,null,{default:a(()=>[t(m(J))]),_:1})]),e[8]||(e[8]=l("div",{class:"header-title"},"周报标题",-1))])]),default:a(()=>[t(p,{prop:"title"},{default:a(()=>[t(w,{modelValue:o.title,"onUpdate:modelValue":e[0]||(e[0]=r=>o.title=r),placeholder:"请输入周报标题，如：前端开发组第12周工作总结",size:"large",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(N,{gutter:20,class:"editor-row"},{default:a(()=>[t(b,{xs:24,lg:12},{default:a(()=>[t(_,{class:"editor-card",shadow:"hover"},{header:a(()=>[l("div",me,[l("div",pe,[t(d,null,{default:a(()=>[t(m(K))]),_:1})]),e[9]||(e[9]=l("div",{class:"header-title"},"本周完成工作",-1))])]),default:a(()=>[t(p,{prop:"accomplishments"},{default:a(()=>[t(w,{modelValue:o.accomplishments,"onUpdate:modelValue":e[1]||(e[1]=r=>o.accomplishments=r),type:"textarea",placeholder:"请详细描述本周完成的工作内容、成果和收获...",rows:8,resize:"none"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(b,{xs:24,lg:12},{default:a(()=>[t(_,{class:"editor-card",shadow:"hover"},{header:a(()=>[l("div",ge,[l("div",_e,[t(d,null,{default:a(()=>[t(m(Q))]),_:1})]),e[10]||(e[10]=l("div",{class:"header-title"},"本周遇到的问题",-1))])]),default:a(()=>[t(p,{prop:"challenges"},{default:a(()=>[t(w,{modelValue:o.challenges,"onUpdate:modelValue":e[2]||(e[2]=r=>o.challenges=r),type:"textarea",placeholder:"请描述本周遇到的问题、挑战和解决方案...",rows:8,resize:"none"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(_,{class:"editor-card",shadow:"hover"},{header:a(()=>[l("div",fe,[l("div",he,[t(d,null,{default:a(()=>[t(m(X))]),_:1})]),e[11]||(e[11]=l("div",{class:"header-title"},"下周工作计划",-1))])]),default:a(()=>[t(p,{prop:"nextWeekPlan"},{default:a(()=>[t(w,{modelValue:o.nextWeekPlan,"onUpdate:modelValue":e[3]||(e[3]=r=>o.nextWeekPlan=r),type:"textarea",placeholder:"请详细描述下周的工作计划、目标和安排...",rows:6,resize:"none"},null,8,["modelValue"])]),_:1})]),_:1}),t(_,{class:"editor-card",shadow:"hover"},{header:a(()=>[l("div",ve,[l("div",ke,[t(d,null,{default:a(()=>[t(m(Z))]),_:1})]),e[12]||(e[12]=l("div",{class:"header-title"},"其他信息",-1))])]),default:a(()=>[t(N,{gutter:20},{default:a(()=>[t(b,{xs:24,sm:12},{default:a(()=>[t(p,{label:"周报日期范围",required:""},{default:a(()=>[t(U,{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=r=>c.value=r),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY/MM/DD","value-format":"YYYY-MM-DD",style:{width:"100%"},onChange:z},null,8,["modelValue"])]),_:1})]),_:1}),t(b,{xs:24,sm:12},{default:a(()=>[t(p,{label:"工作完成度",required:""},{default:a(()=>[t(F,{modelValue:o.completionRate,"onUpdate:modelValue":e[5]||(e[5]=r=>o.completionRate=r),"format-tooltip":B,marks:{0:"0%",25:"25%",50:"50%",75:"75%",100:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l("div",we,[t(s,{onClick:R,plain:""},{default:a(()=>e[13]||(e[13]=[f("取消")])),_:1}),t(s,{type:"primary",loading:k.value,onClick:M,size:"large",class:"submit-button"},{default:a(()=>e[14]||(e[14]=[f(" 保存周报 ")])),_:1},8,["loading"])])]),_:1},8,["model"])])])}}}),Re=ae(be,[["__scopeId","data-v-bf59e179"]]);export{Re as default};
