import{d as de,u as ue,x as H,b as I,r as c,c as J,f as l,w as s,g as n,e as r,p as a,t as S,K as q,D as R,i as w,P as f,L as ie,E as P,M as me,v as y,_ as pe}from"./index-BwdTnk9D.js";const fe={class:"profile-page"},we={class:"user-info"},_e={class:"avatar-container"},ve={class:"accounts-section"},be={class:"section-header"},ge={class:"permission-tags"},Ve={class:"dialog-footer"},Pe={key:0,class:"permissions-dialog"},ye={class:"permission-tips"},Ee={class:"dialog-footer"},ce=de({__name:"Profile",setup(Re){var N,$,M;const U=ue(),x=H(()=>U.getCurrentUser()),V=I({username:((N=x.value)==null?void 0:N.username)||"",name:(($=x.value)==null?void 0:$.name)||"",role:((M=x.value)==null?void 0:M.role)==="admin"?"管理员":"普通用户"}),z=c(),m=I({currentPassword:"",newPassword:"",confirmPassword:""}),Q={currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],newPassword:[{required:!0,validator:(d,e,p)=>{var u;e===""?p(new Error("请输入密码")):(m.confirmPassword!==""&&((u=z.value)==null||u.validateField("confirmPassword")),p())},trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,validator:(d,e,p)=>{e===""?p(new Error("请再次输入密码")):e!==m.newPassword?p(new Error("两次输入密码不一致")):p()},trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}]},k=c(!1),D=c(),t=I({username:"",name:"",password:"",confirmPassword:"",role:"user"}),X={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,validator:(d,e,p)=>{e===""?p(new Error("请再次输入密码")):e!==t.password?p(new Error("两次输入密码不一致")):p()},trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]},Y=H(()=>U.getAllUsers()),Z=async()=>{D.value&&await D.value.validate(d=>{d&&(U.addUser({username:t.username,name:t.name,password:t.password,role:t.role,avatar:""})?(P.success("账号添加成功"),k.value=!1,t.username="",t.name="",t.password="",t.confirmPassword="",t.role="user"):P.error("用户名已存在"))})},h=d=>{me.confirm(`确定要删除用户 ${d.name} 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{U.deleteUser(d.id)?P.success("用户删除成功"):P.error("删除失败")}).catch(()=>{})},ee=async()=>{z.value&&await z.value.validate(d=>{d&&(P.success("密码修改成功"),m.currentPassword="",m.newPassword="",m.confirmPassword="")})},C=c(!1),b=c(null),g=c([]),le=d=>{b.value=d,g.value=[...d.permissions],C.value=!0},se=()=>{if(!b.value)return;g.value.includes(f.VIEW_REPORT)||g.value.push(f.VIEW_REPORT),U.updateUserPermissions(b.value.id,g.value)?(P.success("权限更新成功"),C.value=!1):P.error("权限更新失败")};return(d,e)=>{const p=n("el-avatar"),u=n("el-button"),_=n("el-input"),i=n("el-form-item"),F=n("el-form"),B=n("el-tab-pane"),T=n("el-table-column"),E=n("el-tag"),O=n("el-tooltip"),oe=n("el-table"),ae=n("el-tabs"),re=n("el-card"),W=n("el-option"),te=n("el-select"),L=n("el-dialog"),G=n("el-divider"),A=n("el-checkbox"),K=n("el-checkbox-group"),ne=n("el-icon");return y(),J("div",fe,[l(re,{class:"profile-card"},{header:s(()=>e[18]||(e[18]=[r("div",{class:"card-header"},[r("h2",null,"个人信息"),r("p",null,"管理您的账号信息和设置")],-1)])),default:s(()=>[l(ae,null,{default:s(()=>[l(B,{label:"基本信息"},{default:s(()=>{var o;return[r("div",we,[r("div",_e,[l(p,{size:100,src:(o=x.value)==null?void 0:o.avatar},{default:s(()=>{var v,j;return[a(S(((j=(v=x.value)==null?void 0:v.name)==null?void 0:j.charAt(0))||"U"),1)]}),_:1},8,["src"]),l(u,{type:"primary",class:"upload-btn",plain:""},{default:s(()=>e[19]||(e[19]=[a("更换头像")])),_:1})]),l(F,{model:V,"label-width":"80px"},{default:s(()=>[l(i,{label:"用户名"},{default:s(()=>[l(_,{modelValue:V.username,"onUpdate:modelValue":e[0]||(e[0]=v=>V.username=v),disabled:""},null,8,["modelValue"])]),_:1}),l(i,{label:"姓名"},{default:s(()=>[l(_,{modelValue:V.name,"onUpdate:modelValue":e[1]||(e[1]=v=>V.name=v)},null,8,["modelValue"])]),_:1}),l(i,{label:"角色"},{default:s(()=>[l(_,{modelValue:V.role,"onUpdate:modelValue":e[2]||(e[2]=v=>V.role=v),disabled:""},null,8,["modelValue"])]),_:1}),l(i,null,{default:s(()=>[l(u,{type:"primary"},{default:s(()=>e[20]||(e[20]=[a("保存修改")])),_:1})]),_:1})]),_:1},8,["model"])])]}),_:1}),l(B,{label:"账号管理"},{default:s(()=>[r("div",ve,[r("div",be,[e[22]||(e[22]=r("h3",null,"账号列表",-1)),l(u,{type:"primary",onClick:e[3]||(e[3]=o=>k.value=!0)},{default:s(()=>e[21]||(e[21]=[a("新增账号")])),_:1})]),l(oe,{data:Y.value,style:{width:"100%"},border:""},{default:s(()=>[l(T,{prop:"username",label:"用户名"}),l(T,{prop:"name",label:"姓名"}),l(T,{prop:"role",label:"角色"},{default:s(o=>[l(E,{type:o.row.role==="admin"?"danger":o.row.role==="user"?"success":"info"},{default:s(()=>[a(S(o.row.role==="admin"?"管理员":o.row.role==="user"?"普通用户":"只读用户"),1)]),_:2},1032,["type"])]),_:1}),l(T,{label:"权限",width:"300"},{default:s(o=>[r("div",ge,[o.row.permissions.includes(w(f).VIEW_REPORT)?(y(),q(O,{key:0,content:"允许查看周报",placement:"top"},{default:s(()=>[l(E,{size:"small",type:"success",effect:"plain",class:"permission-tag"},{default:s(()=>e[23]||(e[23]=[a("查看")])),_:1})]),_:1})):R("",!0),o.row.permissions.includes(w(f).CREATE_REPORT)?(y(),q(O,{key:1,content:"允许创建周报",placement:"top"},{default:s(()=>[l(E,{size:"small",type:"primary",effect:"plain",class:"permission-tag"},{default:s(()=>e[24]||(e[24]=[a("创建")])),_:1})]),_:1})):R("",!0),o.row.permissions.includes(w(f).EDIT_REPORT)?(y(),q(O,{key:2,content:"允许编辑周报",placement:"top"},{default:s(()=>[l(E,{size:"small",type:"warning",effect:"plain",class:"permission-tag"},{default:s(()=>e[25]||(e[25]=[a("编辑")])),_:1})]),_:1})):R("",!0),o.row.permissions.includes(w(f).DELETE_REPORT)?(y(),q(O,{key:3,content:"允许删除周报",placement:"top"},{default:s(()=>[l(E,{size:"small",type:"danger",effect:"plain",class:"permission-tag"},{default:s(()=>e[26]||(e[26]=[a("删除")])),_:1})]),_:1})):R("",!0),o.row.permissions.includes(w(f).MANAGE_USERS)?(y(),q(O,{key:4,content:"允许管理用户",placement:"top"},{default:s(()=>[l(E,{size:"small",type:"info",effect:"dark",class:"permission-tag"},{default:s(()=>e[27]||(e[27]=[a("用户管理")])),_:1})]),_:1})):R("",!0)])]),_:1}),l(T,{label:"操作",width:"200"},{default:s(o=>[l(u,{type:"primary",plain:"",size:"small",disabled:o.row.username==="admin",onClick:v=>le(o.row)},{default:s(()=>e[28]||(e[28]=[a(" 权限设置 ")])),_:2},1032,["disabled","onClick"]),l(u,{type:"danger",plain:"",size:"small",disabled:o.row.username==="admin",onClick:v=>h(o.row)},{default:s(()=>e[29]||(e[29]=[a(" 删除 ")])),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"])])]),_:1}),l(B,{label:"修改密码"},{default:s(()=>[l(F,{model:m,"label-width":"120px",rules:Q,ref_key:"passwordFormRef",ref:z},{default:s(()=>[l(i,{label:"当前密码",prop:"currentPassword"},{default:s(()=>[l(_,{modelValue:m.currentPassword,"onUpdate:modelValue":e[4]||(e[4]=o=>m.currentPassword=o),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(i,{label:"新密码",prop:"newPassword"},{default:s(()=>[l(_,{modelValue:m.newPassword,"onUpdate:modelValue":e[5]||(e[5]=o=>m.newPassword=o),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(i,{label:"确认新密码",prop:"confirmPassword"},{default:s(()=>[l(_,{modelValue:m.confirmPassword,"onUpdate:modelValue":e[6]||(e[6]=o=>m.confirmPassword=o),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),l(i,null,{default:s(()=>[l(u,{type:"primary",onClick:ee},{default:s(()=>e[30]||(e[30]=[a("修改密码")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1}),l(L,{modelValue:k.value,"onUpdate:modelValue":e[13]||(e[13]=o=>k.value=o),title:"新增账号",width:"500px"},{footer:s(()=>[r("span",Ve,[l(u,{onClick:e[12]||(e[12]=o=>k.value=!1)},{default:s(()=>e[31]||(e[31]=[a("取消")])),_:1}),l(u,{type:"primary",onClick:Z},{default:s(()=>e[32]||(e[32]=[a("确认")])),_:1})])]),default:s(()=>[l(F,{model:t,"label-width":"80px",rules:X,ref_key:"newUserFormRef",ref:D},{default:s(()=>[l(i,{label:"用户名",prop:"username"},{default:s(()=>[l(_,{modelValue:t.username,"onUpdate:modelValue":e[7]||(e[7]=o=>t.username=o),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(i,{label:"姓名",prop:"name"},{default:s(()=>[l(_,{modelValue:t.name,"onUpdate:modelValue":e[8]||(e[8]=o=>t.name=o),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),l(i,{label:"密码",prop:"password"},{default:s(()=>[l(_,{modelValue:t.password,"onUpdate:modelValue":e[9]||(e[9]=o=>t.password=o),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),l(i,{label:"确认密码",prop:"confirmPassword"},{default:s(()=>[l(_,{modelValue:t.confirmPassword,"onUpdate:modelValue":e[10]||(e[10]=o=>t.confirmPassword=o),type:"password",placeholder:"请再次输入密码","show-password":""},null,8,["modelValue"])]),_:1}),l(i,{label:"角色",prop:"role"},{default:s(()=>[l(te,{modelValue:t.role,"onUpdate:modelValue":e[11]||(e[11]=o=>t.role=o),placeholder:"请选择角色",style:{width:"100%"}},{default:s(()=>[l(W,{label:"管理员",value:"admin"}),l(W,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(L,{modelValue:C.value,"onUpdate:modelValue":e[17]||(e[17]=o=>C.value=o),title:"权限设置",width:"500px"},{footer:s(()=>[r("span",Ee,[l(u,{onClick:e[16]||(e[16]=o=>C.value=!1)},{default:s(()=>e[42]||(e[42]=[a("取消")])),_:1}),l(u,{type:"primary",onClick:se},{default:s(()=>e[43]||(e[43]=[a("保存")])),_:1})])]),default:s(()=>[b.value?(y(),J("div",Pe,[r("h3",null,S(b.value.name)+" 的权限设置",1),l(G,{"content-position":"left"},{default:s(()=>e[33]||(e[33]=[a("周报权限")])),_:1}),l(K,{modelValue:g.value,"onUpdate:modelValue":e[14]||(e[14]=o=>g.value=o)},{default:s(()=>[l(A,{label:w(f).VIEW_REPORT},{default:s(()=>e[34]||(e[34]=[a("查看周报")])),_:1},8,["label"]),l(A,{label:w(f).CREATE_REPORT,disabled:b.value.role==="viewer"},{default:s(()=>e[35]||(e[35]=[a("创建周报")])),_:1},8,["label","disabled"]),l(A,{label:w(f).EDIT_REPORT,disabled:b.value.role==="viewer"},{default:s(()=>e[36]||(e[36]=[a("编辑周报")])),_:1},8,["label","disabled"]),l(A,{label:w(f).DELETE_REPORT,disabled:b.value.role==="viewer"},{default:s(()=>e[37]||(e[37]=[a("删除周报")])),_:1},8,["label","disabled"])]),_:1},8,["modelValue"]),l(G,{"content-position":"left"},{default:s(()=>e[38]||(e[38]=[a("管理权限")])),_:1}),l(K,{modelValue:g.value,"onUpdate:modelValue":e[15]||(e[15]=o=>g.value=o)},{default:s(()=>[l(A,{label:w(f).MANAGE_USERS,disabled:b.value.role!=="admin"},{default:s(()=>e[39]||(e[39]=[a("用户管理")])),_:1},8,["label","disabled"])]),_:1},8,["modelValue"]),r("div",ye,[r("p",null,[l(ne,null,{default:s(()=>[l(w(ie))]),_:1}),e[40]||(e[40]=r("span",null,"权限说明:",-1))]),e[41]||(e[41]=r("ul",null,[r("li",null,[r("strong",null,"查看周报"),a(": 用户可以查看周报列表和详情")]),r("li",null,[r("strong",null,"创建周报"),a(": 用户可以创建新的周报")]),r("li",null,[r("strong",null,"编辑周报"),a(": 用户可以编辑周报内容")]),r("li",null,[r("strong",null,"删除周报"),a(": 用户可以删除周报")]),r("li",null,[r("strong",null,"用户管理"),a(": 用户可以管理其他用户账号和权限")])],-1))])])):R("",!0)]),_:1},8,["modelValue"])])}}}),Te=pe(ce,[["__scopeId","data-v-9096bf99"]]);export{Te as default};
