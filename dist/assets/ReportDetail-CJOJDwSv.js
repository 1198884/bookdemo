import{d as K,u as X,r as M,a3 as Y,x as Z,o as G,q as Q,E as p,a as U,c as h,f as e,w as o,g as u,a0 as ee,e as n,K as D,D as g,p as i,t as _,i as r,$ as L,a1 as te,a4 as oe,V as ne,j as C,a5 as se,a6 as le,Z as ae,a7 as re,Y as x,P as w,T as ie,R as ue,X as de,k as N,a8 as ce,M as pe,v as f,_ as _e}from"./index-BwdTnk9D.js";import{u as fe}from"./report-C7K7dR-S.js";const me={class:"report-detail"},ve={class:"header-content"},he={class:"header-left"},ge={class:"header-actions"},ye={key:0,class:"report-content"},ke={class:"report-header"},we={class:"report-meta"},Re={class:"meta-item"},Ee={class:"meta-item"},Te={key:0,class:"meta-item"},De={key:1,class:"meta-item"},Ce={class:"report-body"},Pe={class:"content-sections"},$e={class:"content-section"},Se={class:"section-header"},Me=["innerHTML"],Le={key:0,class:"content-section"},xe={class:"section-header"},Ne=["innerHTML"],be={class:"content-section"},Be={class:"section-header"},He=["innerHTML"],Ie={class:"action-buttons"},Oe={class:"detail-actions"},We=K({__name:"ReportDetail",setup(Ve){const P=Q(),y=U(),R=fe(),$=X(),m=M(!0),s=M(null);Y(()=>P.params.id,l=>{if(l){m.value=!0;const t=R.getReport(l);s.value=t,t||(p.error("周报不存在"),y.push("/report/list")),m.value=!1}},{immediate:!0});const d=Z(()=>{if(!s.value)return{accomplishments:"",challenges:"",nextWeekPlan:""};if(typeof s.value.content=="string")try{return JSON.parse(s.value.content)}catch{return{accomplishments:s.value.content||"",challenges:"",nextWeekPlan:""}}return s.value.content}),S=l=>new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),E=l=>l?l.replace(/\n/g,"<br>"):"",b=()=>{if(!$.hasPermission(w.EDIT_REPORT)){p.error("您没有编辑周报的权限");return}s.value&&y.push(`/report/edit/${s.value.id}`)},B=()=>{if(!$.hasPermission(w.DELETE_REPORT)){p.error("您没有删除周报的权限");return}s.value&&pe.confirm("确定要删除这份周报吗？此操作不可恢复。","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{s.value&&(R.deleteReport(s.value.id),p.success("周报已删除"),y.push("/report/list"))}).catch(()=>{})},H=()=>{p.success("PDF导出功能正在开发中")},I=()=>{p.success("Word导出功能正在开发中")},O=()=>{p.success("分享功能正在开发中")};return G(async()=>{try{m.value=!0;const l=P.params.id;if(!l)throw new Error("报告ID不能为空");const t=R.getReport(l);if(t)s.value=t,console.log("加载周报成功:",s.value.title);else try{const v=localStorage.getItem("current-viewing-report");if(v){const a=JSON.parse(v);if(a.id===l)s.value=a,console.log("从缓存恢复周报:",a.title);else throw new Error("缓存的报告ID不匹配")}else throw new Error("未找到缓存的报告")}catch(v){throw console.error("从缓存恢复失败:",v),new Error("未找到指定周报")}}catch(l){console.error("加载周报失败:",l),p.error(l instanceof Error?l.message:"加载周报失败"),y.push("/report/list")}finally{m.value=!1}}),(l,t)=>{const v=u("el-tag"),a=u("el-icon"),c=u("el-button"),W=u("el-header"),V=u("el-card"),T=u("el-dropdown-item"),A=u("el-dropdown-menu"),F=u("el-dropdown"),J=u("el-empty"),j=u("el-main"),q=u("el-container"),z=te("loading");return f(),h("div",me,[e(q,null,{default:o(()=>[e(W,null,{default:o(()=>[n("div",ve,[n("div",he,[t[5]||(t[5]=n("h4",null,"周报详情",-1)),s.value?(f(),D(v,{key:0,type:"info",effect:"plain"},{default:o(()=>[i(_(s.value.year)+"年 第"+_(s.value.weekNumber)+"周 ",1)]),_:1})):g("",!0)]),n("div",ge,[e(c,{onClick:t[0]||(t[0]=k=>l.$router.push("/report/list")),plain:""},{default:o(()=>[e(a,null,{default:o(()=>[e(r(L))]),_:1}),t[6]||(t[6]=i(" 返回列表 "))]),_:1})])])]),_:1}),ee((f(),D(j,null,{default:o(()=>[s.value?(f(),h("div",ye,[e(V,{class:"report-card",shadow:"hover"},{header:o(()=>[n("div",ke,[n("h2",null,_(s.value.title),1),n("div",we,[n("div",Re,[e(a,null,{default:o(()=>[e(r(C))]),_:1}),n("span",null,"创建时间："+_(S(s.value.createdAt)),1)]),n("div",Ee,[e(a,null,{default:o(()=>[e(r(se))]),_:1}),n("span",null,"更新时间："+_(S(s.value.updatedAt)),1)]),d.value.weekStart&&d.value.weekEnd?(f(),h("div",Te,[e(a,null,{default:o(()=>[e(r(C))]),_:1}),n("span",null,"周报日期："+_(d.value.weekStart)+" 至 "+_(d.value.weekEnd),1)])):g("",!0),d.value.completionRate!==void 0?(f(),h("div",De,[e(a,null,{default:o(()=>[e(r(le))]),_:1}),n("span",null,"完成率："+_(d.value.completionRate)+"%",1)])):g("",!0)])])]),default:o(()=>[n("div",Ce,[n("div",Pe,[n("div",$e,[n("div",Se,[e(a,null,{default:o(()=>[e(r(oe))]),_:1}),t[7]||(t[7]=n("h3",null,"本周工作进展",-1))]),n("div",{class:"section-content",innerHTML:E(d.value.accomplishments)},null,8,Me)]),d.value.challenges?(f(),h("div",Le,[n("div",xe,[e(a,null,{default:o(()=>[e(r(ne))]),_:1}),t[8]||(t[8]=n("h3",null,"本周遇到的问题",-1))]),n("div",{class:"section-content",innerHTML:E(d.value.challenges)},null,8,Ne)])):g("",!0),n("div",be,[n("div",Be,[e(a,null,{default:o(()=>[e(r(C))]),_:1}),t[9]||(t[9]=n("h3",null,"下周工作计划",-1))]),n("div",{class:"section-content",innerHTML:E(d.value.nextWeekPlan)},null,8,He)])])])]),_:1}),n("div",Ie,[e(c,{type:"primary",onClick:t[1]||(t[1]=k=>l.$router.push("/report/create"))},{default:o(()=>[e(a,null,{default:o(()=>[e(r(ae))]),_:1}),t[10]||(t[10]=i(" 创建新周报 "))]),_:1}),e(c,{onClick:t[2]||(t[2]=k=>l.$router.push("/"))},{default:o(()=>[e(a,null,{default:o(()=>[e(r(re))]),_:1}),t[11]||(t[11]=i(" 返回首页 "))]),_:1})]),n("div",Oe,[e(c,{type:"primary",plain:"",onClick:t[3]||(t[3]=k=>l.$router.push("/report/list"))},{default:o(()=>[e(a,null,{default:o(()=>[e(r(L))]),_:1}),t[12]||(t[12]=i(" 返回列表 "))]),_:1}),e(x,{permission:r(w).EDIT_REPORT},{default:o(()=>[e(c,{type:"success",plain:"",onClick:b},{default:o(()=>[e(a,null,{default:o(()=>[e(r(ie))]),_:1}),t[13]||(t[13]=i(" 编辑周报 "))]),_:1})]),_:1},8,["permission"]),e(x,{permission:r(w).DELETE_REPORT},{default:o(()=>[e(c,{type:"danger",plain:"",onClick:B},{default:o(()=>[e(a,null,{default:o(()=>[e(r(ue))]),_:1}),t[14]||(t[14]=i(" 删除周报 "))]),_:1})]),_:1},8,["permission"]),e(F,null,{dropdown:o(()=>[e(A,null,{default:o(()=>[e(T,{onClick:H},{default:o(()=>[e(a,null,{default:o(()=>[e(r(N))]),_:1}),t[16]||(t[16]=i("导出为PDF "))]),_:1}),e(T,{onClick:I},{default:o(()=>[e(a,null,{default:o(()=>[e(r(N))]),_:1}),t[17]||(t[17]=i("导出为Word "))]),_:1}),e(T,{divided:"",onClick:O},{default:o(()=>[e(a,null,{default:o(()=>[e(r(ce))]),_:1}),t[18]||(t[18]=i("分享 "))]),_:1})]),_:1})]),default:o(()=>[e(c,{type:"primary"},{default:o(()=>[t[15]||(t[15]=i(" 更多操作 ")),e(a,{class:"el-icon--right"},{default:o(()=>[e(r(de))]),_:1})]),_:1})]),_:1})])])):m.value?g("",!0):(f(),D(J,{key:1,description:"周报不存在"},{default:o(()=>[e(c,{type:"primary",onClick:t[4]||(t[4]=k=>l.$router.push("/report/list"))},{default:o(()=>t[19]||(t[19]=[i(" 返回列表 ")])),_:1})]),_:1}))]),_:1})),[[z,m.value]])]),_:1})])}}}),Je=_e(We,[["__scopeId","data-v-a3f6ea9e"]]);export{Je as default};
