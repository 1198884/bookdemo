import{d as H,u as K,N as L,P as X,E as p,r as Y,b as C,o as Z,c as T,f as t,w as l,g as n,e as r,p as i,i as v,O as ee,Q as te,R as le,D as oe,S as ae,t as se,M as y,v as I,_ as ne}from"./index-BwdTnk9D.js";import{u as re}from"./report-C7K7dR-S.js";const ie={class:"settings-page"},de={class:"data-management"},ue={class:"action-buttons"},me={class:"settings-actions"},pe={class:"import-dialog"},ce={key:0,class:"warning-box"},ge={class:"dialog-footer"},fe=H({__name:"Settings",setup(_e){const N=K(),F=re(),D=L();N.hasPermission(X.MANAGE_USERS)||p.error("您没有权限访问此页面");const k=Y("basic"),_=Y(!1),g=Y(null),M=()=>{try{const a=localStorage.getItem("basic-settings"),e=localStorage.getItem("report-settings");a&&Object.assign(d,JSON.parse(a)),e&&Object.assign(u,JSON.parse(e))}catch(a){console.error("加载设置失败:",a),p.error("设置加载失败，将使用默认设置")}},d=C({systemName:"周报管理系统",dateFormat:"YYYY-MM-DD",language:"zh-CN",get theme(){return D.currentTheme},set theme(a){D.setTheme(a)}}),u=C({defaultTemplate:"standard",requiredFields:["accomplishments","nextWeekPlan"],autoSave:!0}),U=()=>{try{localStorage.setItem("basic-settings",JSON.stringify(d)),localStorage.setItem("report-settings",JSON.stringify(u)),p.success("设置已保存")}catch(a){console.error("保存设置失败:",a),p.error("保存设置失败")}},B=()=>{y.confirm("确定要重置所有设置到默认值吗？","重置确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Object.assign(d,{systemName:"周报管理系统",dateFormat:"YYYY-MM-DD",language:"zh-CN",theme:"light"}),Object.assign(u,{defaultTemplate:"standard",requiredFields:["accomplishments","nextWeekPlan"],autoSave:!0}),p.success("设置已重置为默认值")}).catch(()=>{})},R=()=>{try{const a={reports:localStorage.getItem("weekly-reports")?JSON.parse(localStorage.getItem("weekly-reports")||"[]"):[],users:N.getAllUsers(),settings:{basic:d,report:u},exportDate:new Date().toISOString()},e=JSON.stringify(a,null,2),f="data:application/json;charset=utf-8,"+encodeURIComponent(e),o=`weekly-report-backup-${new Date().toISOString().split("T")[0]}.json`,m=document.createElement("a");m.setAttribute("href",f),m.setAttribute("download",o),m.click(),p.success("数据导出成功")}catch(a){console.error("数据导出失败:",a),p.error("数据导出失败")}},A=a=>{g.value=a.raw},E=()=>{if(!g.value){p.warning("请先选择要导入的文件");return}const a=new FileReader;a.onload=e=>{var f;try{const o=JSON.parse((f=e.target)==null?void 0:f.result);if(!o.reports||!o.settings)throw new Error("导入的数据格式无效");Array.isArray(o.reports)&&localStorage.setItem("weekly-reports",JSON.stringify(o.reports)),o.settings.basic&&(Object.assign(d,o.settings.basic),localStorage.setItem("basic-settings",JSON.stringify(o.settings.basic))),o.settings.report&&(Object.assign(u,o.settings.report),localStorage.setItem("report-settings",JSON.stringify(o.settings.report))),p.success("数据导入成功"),_.value=!1,y.confirm("数据已成功导入，是否刷新页面以应用更改？","导入成功",{confirmButtonText:"刷新页面",cancelButtonText:"稍后刷新",type:"success"}).then(()=>{window.location.reload()}).catch(()=>{})}catch(o){console.error("数据导入失败:",o),p.error("数据导入失败，请确保文件格式正确")}},a.readAsText(g.value)},J=()=>{y.confirm("此操作将清除所有周报数据和自定义设置，但保留用户账号信息。此操作不可恢复，是否继续？","数据重置警告",{confirmButtonText:"确认重置",cancelButtonText:"取消",type:"warning",distinguishCancelAndClose:!0}).then(()=>{y.prompt('请输入"CONFIRM"以确认重置操作',"安全确认",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/^CONFIRM$/,inputErrorMessage:"请输入正确的确认文本",type:"warning"}).then(({value:a})=>{a==="CONFIRM"&&(F.clearAllReports(),localStorage.removeItem("basic-settings"),localStorage.removeItem("report-settings"),M(),p.success("系统数据已重置"))}).catch(()=>{})}).catch(()=>{})};return Z(()=>{M()}),(a,e)=>{const f=n("el-input"),o=n("el-form-item"),m=n("el-option"),w=n("el-select"),x=n("el-radio"),j=n("el-radio-group"),O=n("el-form"),V=n("el-tab-pane"),b=n("el-checkbox"),P=n("el-checkbox-group"),q=n("el-switch"),S=n("el-icon"),c=n("el-button"),$=n("el-divider"),z=n("el-tabs"),W=n("el-card"),h=n("el-upload"),G=n("el-alert"),Q=n("el-dialog");return I(),T("div",ie,[t(W,{class:"settings-card"},{header:l(()=>e[11]||(e[11]=[r("div",{class:"card-header"},[r("h2",null,"系统设置"),r("p",null,"配置系统全局参数和选项")],-1)])),default:l(()=>[t(z,{modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=s=>k.value=s)},{default:l(()=>[t(V,{label:"基本设置",name:"basic"},{default:l(()=>[t(O,{model:d,"label-width":"120px"},{default:l(()=>[t(o,{label:"系统名称"},{default:l(()=>[t(f,{modelValue:d.systemName,"onUpdate:modelValue":e[0]||(e[0]=s=>d.systemName=s)},null,8,["modelValue"])]),_:1}),t(o,{label:"周报日期格式"},{default:l(()=>[t(w,{modelValue:d.dateFormat,"onUpdate:modelValue":e[1]||(e[1]=s=>d.dateFormat=s),style:{width:"100%"}},{default:l(()=>[t(m,{label:"YYYY-MM-DD",value:"YYYY-MM-DD"}),t(m,{label:"MM/DD/YYYY",value:"MM/DD/YYYY"}),t(m,{label:"DD/MM/YYYY",value:"DD/MM/YYYY"})]),_:1},8,["modelValue"])]),_:1}),t(o,{label:"默认语言"},{default:l(()=>[t(w,{modelValue:d.language,"onUpdate:modelValue":e[2]||(e[2]=s=>d.language=s),style:{width:"100%"}},{default:l(()=>[t(m,{label:"简体中文",value:"zh-CN"}),t(m,{label:"English",value:"en-US"})]),_:1},8,["modelValue"])]),_:1}),t(o,{label:"显示模式"},{default:l(()=>[t(j,{modelValue:d.theme,"onUpdate:modelValue":e[3]||(e[3]=s=>d.theme=s)},{default:l(()=>[t(x,{label:"light"},{default:l(()=>e[12]||(e[12]=[i("浅色模式")])),_:1}),t(x,{label:"dark"},{default:l(()=>e[13]||(e[13]=[i("深色模式")])),_:1}),t(x,{label:"system"},{default:l(()=>e[14]||(e[14]=[i("跟随系统")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),t(V,{label:"周报设置",name:"report"},{default:l(()=>[t(O,{model:u,"label-width":"120px"},{default:l(()=>[t(o,{label:"默认周报模板"},{default:l(()=>[t(w,{modelValue:u.defaultTemplate,"onUpdate:modelValue":e[4]||(e[4]=s=>u.defaultTemplate=s),style:{width:"100%"}},{default:l(()=>[t(m,{label:"标准模板",value:"standard"}),t(m,{label:"简洁模板",value:"simple"}),t(m,{label:"详细模板",value:"detailed"})]),_:1},8,["modelValue"])]),_:1}),t(o,{label:"必填字段"},{default:l(()=>[t(P,{modelValue:u.requiredFields,"onUpdate:modelValue":e[5]||(e[5]=s=>u.requiredFields=s)},{default:l(()=>[t(b,{label:"accomplishments"},{default:l(()=>e[15]||(e[15]=[i("本周成就")])),_:1}),t(b,{label:"challenges"},{default:l(()=>e[16]||(e[16]=[i("遇到的挑战")])),_:1}),t(b,{label:"nextWeekPlan"},{default:l(()=>e[17]||(e[17]=[i("下周计划")])),_:1}),t(b,{label:"completionRate"},{default:l(()=>e[18]||(e[18]=[i("完成率")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(o,{label:"自动保存"},{default:l(()=>[t(q,{modelValue:u.autoSave,"onUpdate:modelValue":e[6]||(e[6]=s=>u.autoSave=s)},null,8,["modelValue"]),e[19]||(e[19]=r("span",{class:"setting-desc"},"启用后每30秒自动保存编辑中的周报",-1))]),_:1})]),_:1},8,["model"])]),_:1}),t(V,{label:"数据管理",name:"data"},{default:l(()=>[r("div",de,[e[23]||(e[23]=r("h3",null,"数据导入导出",-1)),e[24]||(e[24]=r("p",null,"您可以导出系统数据进行备份，或导入之前的备份数据",-1)),r("div",ue,[t(c,{type:"primary",onClick:R},{default:l(()=>[t(S,null,{default:l(()=>[t(v(ee))]),_:1}),e[20]||(e[20]=i("导出数据 "))]),_:1}),t(c,{type:"success",onClick:e[7]||(e[7]=s=>_.value=!0)},{default:l(()=>[t(S,null,{default:l(()=>[t(v(te))]),_:1}),e[21]||(e[21]=i("导入数据 "))]),_:1})]),t($),e[25]||(e[25]=r("h3",null,"数据重置",-1)),e[26]||(e[26]=r("p",{class:"warning-text"},"危险操作：重置将清除所有系统数据，此操作不可恢复",-1)),t(c,{type:"danger",onClick:J},{default:l(()=>[t(S,null,{default:l(()=>[t(v(le))]),_:1}),e[22]||(e[22]=i("重置系统数据 "))]),_:1})])]),_:1})]),_:1},8,["modelValue"]),r("div",me,[t(c,{type:"primary",onClick:U},{default:l(()=>e[27]||(e[27]=[i("保存设置")])),_:1}),t(c,{onClick:B},{default:l(()=>e[28]||(e[28]=[i("重置")])),_:1})])]),_:1}),t(Q,{modelValue:_.value,"onUpdate:modelValue":e[10]||(e[10]=s=>_.value=s),title:"导入数据",width:"500px"},{footer:l(()=>[r("span",ge,[t(c,{onClick:e[9]||(e[9]=s=>_.value=!1)},{default:l(()=>e[31]||(e[31]=[i("取消")])),_:1}),t(c,{type:"primary",onClick:E,disabled:!g.value},{default:l(()=>e[32]||(e[32]=[i(" 确认导入 ")])),_:1},8,["disabled"])])]),default:l(()=>[r("div",pe,[t(h,{class:"upload-demo",drag:"",action:"#","auto-upload":!1,"on-change":A,limit:1,accept:".json"},{tip:l(()=>e[29]||(e[29]=[r("div",{class:"el-upload__tip"}," 请上传JSON格式的备份文件 ",-1)])),default:l(()=>[t(S,{class:"el-icon--upload"},{default:l(()=>[t(v(ae))]),_:1}),e[30]||(e[30]=r("div",{class:"el-upload__text"},[i(" 拖拽文件到此处或 "),r("em",null,"点击上传")],-1))]),_:1}),g.value?(I(),T("div",ce,[t(G,{title:"导入数据将覆盖当前数据，请确认操作",type:"warning","show-icon":""}),r("p",null,"已选择文件: "+se(g.value.name),1)])):oe("",!0)])]),_:1},8,["modelValue"])])}}}),ve=ne(fe,[["__scopeId","data-v-12df8c9c"]]);export{ve as default};
